<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.plj.dao.admin.sys.MenuDao">
  <resultMap id="menu" type="com.plj.domain.decorate.admin.sys.Menu">
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="name" jdbcType="VARCHAR" property="name" />
    <result column="p_id" jdbcType="INTEGER" property="pId" />
    <result column="lft" jdbcType="INTEGER" property="lft" />
    <result column="rgt" jdbcType="INTEGER" property="rgt" />
    <result column="is_parent" jdbcType="TINYINT" property="isParent" />
    <result column="icon" jdbcType="VARCHAR" property="icon" />
    <result column="menu_desc" jdbcType="VARCHAR" property="menuDesc" />
    <result column="menu_type" jdbcType="VARCHAR" property="menuType" />
  </resultMap>
  <sql id="field">
    id, name, p_id, lft, rgt, is_parent, icon, menu_desc, menu_type
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="menu">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 'true' as QUERYID,
    <include refid="field" />
    from sys_menu_t
    where id = #{id,jdbcType=INTEGER}
  </select>
  <insert id="insert" parameterType="com.plj.domain.decorate.admin.sys.Menu"  useGeneratedKeys="true" keyProperty="id">
    INSERT INTO sys_menu_t(id, name, p_id, lft, rgt, is_parent, icon, menu_desc, menu_type) 
    VALUES(
    	#{id,jdbcType=INTEGER},  #{name,jdbcType=VARCHAR},
        #{pId,jdbcType=INTEGER}, #{lft,jdbcType=INTEGER},
        #{rgt,jdbcType=INTEGER}, #{isParent,jdbcType=TINYINT},
        #{icon,jdbcType=VARCHAR}, #{menuDesc,jdbcType=VARCHAR},
        #{menuType,jdbcType=VARCHAR}
    );
  </insert>
  <insert id="insertSelective" parameterType="com.plj.domain.decorate.admin.sys.Menu">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into sys_menu_t
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="name != null">
        name,
      </if>
      <if test="pId != null">
        p_id,
      </if>
      <if test="lft != null">
        lft,
      </if>
      <if test="rgt != null">
        rgt,
      </if>
      <if test="isParent != null">
        is_parent,
      </if>
      <if test="icon != null">
        icon,
      </if>
      <if test="menuDesc != null">
        menu_desc,
      </if>
      <if test="menuType != null">
        menu_type,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=INTEGER},
      </if>
      <if test="name != null">
        #{name,jdbcType=VARCHAR},
      </if>
      <if test="pId != null">
        #{pId,jdbcType=INTEGER},
      </if>
      <if test="lft != null">
        #{lft,jdbcType=INTEGER},
      </if>
      <if test="rgt != null">
        #{rgt,jdbcType=INTEGER},
      </if>
      <if test="isParent != null">
        #{isParent,jdbcType=TINYINT},
      </if>
      <if test="icon != null">
        #{icon,jdbcType=VARCHAR},
      </if>
      <if test="menuDesc != null">
        #{menuDesc,jdbcType=VARCHAR},
      </if>
      <if test="menuType != null">
        #{menuType,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.plj.domain.decorate.admin.sys.Menu">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update sys_menu_t
    <set>
      <if test="name != null">
        name = #{name,jdbcType=VARCHAR},
      </if>
      <!-- 暂时不支持父节点的改变 -->
      <!-- <if test="pId != null">
        p_id = #{pId,jdbcType=INTEGER},
      </if>
      <if test="lft != null">
        lft = #{lft,jdbcType=INTEGER},
      </if>
      <if test="rgt != null">
        rgt = #{rgt,jdbcType=INTEGER},
      </if> -->
      <if test="isParent != null">
        is_parent = #{isParent,jdbcType=TINYINT},
      </if>
      <if test="icon != null">
        icon = #{icon,jdbcType=VARCHAR},
      </if>
      <if test="menuDesc != null">
        menu_desc = #{menuDesc,jdbcType=VARCHAR},
      </if>
      <if test="menuType != null">
        menu_type = #{menuType,jdbcType=VARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.plj.domain.decorate.admin.sys.Menu">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update sys_menu_t
    set name = #{name,jdbcType=VARCHAR},
      p_id = #{pId,jdbcType=INTEGER},
      lft = #{lft,jdbcType=INTEGER},
      rgt = #{rgt,jdbcType=INTEGER},
      is_parent = #{isParent,jdbcType=TINYINT},
      icon = #{icon,jdbcType=VARCHAR},
      menu_desc = #{menuDesc,jdbcType=VARCHAR},
      menu_type = #{menuType,jdbcType=VARCHAR}
    where id = #{id,jdbcType=INTEGER}
  </update>
  
  <select id="selectList" parameterType="map" resultMap="menu">
  	SELECT * FROM sys_menu_t
  	<where>
  		<if test="null != lft">
  			lft > #{lft}
  		</if>
  		<if test="null != rgt">
  		<![CDATA[
  			AND rgt  < #{rgt}
  		]]>
  		</if>
  	</where>
  </select>
  
  <select id="selectMaxRight" resultType="int">
  	SELECT MAX(rgt) FROM sys_menu_t;
  </select>
  
  <update id="updateRgt" parameterType="map">
  	<choose>
  		<when test="add != null">
	  		UPDATE sys_menu_t SET rgt = rgt + 2 WHERE rgt >= #{right,jdbcType=INTEGER}; 
  		</when>
  		<otherwise>
  			UPDATE sys_menu_t SET rgt = rgt - #{width,jdbcType=INTEGER} WHERE rgt > #{right,jdbcType=INTEGER}; 
  		</otherwise>
  	</choose>
  </update>  
  
  <update id="updateLft" parameterType="map">
  	<choose>
  		<when test="add != null">
		  	UPDATE sys_menu_t SET lft = lft + 2 WHERE lft > #{right,jdbcType=INTEGER}; 
  		</when>
  		<otherwise>
  			UPDATE sys_menu_t SET lft = lft - #{width,jdbcType=INTEGER} WHERE lft > #{right,jdbcType=INTEGER}; 
  		</otherwise>
  	</choose>
  </update>
  
  <delete id="deleteByPrimaryKeys" parameterType="list">
  	DELETE FROM sys_menu_t
  	WHERE id IN(
	  		<foreach collection="keys" separator="," item="id">
	  			#{id}
	  		</foreach>
	  	)
  </delete>
</mapper>